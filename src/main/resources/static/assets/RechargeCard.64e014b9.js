import{_ as D,r as g,h as b,a as s,o as T,c as U,b as t,w as l,e as v,d as x,i as y,m as q,x as B}from"./index.5bfda754.js";import{a as F}from"./axios.3a665b0f.js";const N={class:"recharge-card"},A={class:"result-content"},G={__name:"RechargeCard",setup(H){const p=g(null),_=g(!1),i=g(!1),o=b({success:!1,title:"",subTitle:""}),a=b({studentId:"",amount:50,paymentMethod:"alipay"}),w=b({studentId:[{required:!0,message:"请输入学生ID",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],amount:[{required:!0,message:"请输入充值金额",trigger:"blur"},{type:"number",min:1,message:"金额必须大于0",trigger:"blur"}],paymentMethod:[{required:!0,message:"请选择支付方式",trigger:"change"}]}),h=async r=>{r&&await r.validate(async e=>{var m,d;if(e)try{_.value=!0;const u=await F.put(`/api/v1/cards/student/${a.studentId}/balance`,{amount:a.amount,type:"RECHARGE",description:`通过${a.paymentMethod==="alipay"?"支付宝":a.paymentMethod==="wechat"?"微信支付":"银行卡"}充值`});u.data.code===200?(o.success=!0,o.title="充值成功",o.subTitle=`已成功向学生ID为 ${a.studentId} 的校园卡充值 ¥${a.amount}，${u.data.msg}`,i.value=!0,V(r)):(o.success=!1,o.title="充值失败",o.subTitle=u.data.msg||"请检查学生ID是否正确",i.value=!0)}catch(u){o.success=!1,o.title="充值失败",o.subTitle=((d=(m=u.response)==null?void 0:m.data)==null?void 0:d.msg)||u.message||"请检查学生ID是否正确",i.value=!0}finally{_.value=!1}})},V=r=>{r&&r.resetFields()};return(r,e)=>{const m=s("el-input"),d=s("el-form-item"),u=s("el-input-number"),c=s("el-option"),C=s("el-select"),I=s("el-icon"),f=s("el-button"),$=s("el-form"),k=s("el-card"),M=s("el-result"),R=s("el-dialog");return T(),U("div",N,[t(k,{class:"card-container"},{header:l(()=>e[7]||(e[7]=[v("div",{class:"card-header"},[v("h3",null,"校园卡余额充值")],-1)])),default:l(()=>[t($,{ref_key:"formRef",ref:p,model:a,rules:w,"label-width":"120px","label-position":"right","status-icon":""},{default:l(()=>[t(d,{label:"学生ID",prop:"studentId"},{default:l(()=>[t(m,{modelValue:a.studentId,"onUpdate:modelValue":e[0]||(e[0]=n=>a.studentId=n),placeholder:"请输入学生ID",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"充值金额",prop:"amount"},{default:l(()=>[t(u,{modelValue:a.amount,"onUpdate:modelValue":e[1]||(e[1]=n=>a.amount=n),min:1,precision:2,step:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(d,{label:"支付方式",prop:"paymentMethod"},{default:l(()=>[t(C,{modelValue:a.paymentMethod,"onUpdate:modelValue":e[2]||(e[2]=n=>a.paymentMethod=n),placeholder:"请选择支付方式",style:{width:"100%"}},{default:l(()=>[t(c,{label:"支付宝",value:"alipay"}),t(c,{label:"微信支付",value:"wechat"}),t(c,{label:"银行卡",value:"bank"})]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:l(()=>[t(f,{type:"primary",onClick:e[3]||(e[3]=n=>h(p.value)),loading:_.value},{default:l(()=>[t(I,null,{default:l(()=>[t(x(q))]),_:1}),e[8]||(e[8]=y("充值 "))]),_:1,__:[8]},8,["loading"]),t(f,{onClick:e[4]||(e[4]=n=>V(p.value))},{default:l(()=>[t(I,null,{default:l(()=>[t(x(B))]),_:1}),e[9]||(e[9]=y("重置 "))]),_:1,__:[9]})]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(R,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=n=>i.value=n),title:"充值结果",width:"30%",center:""},{default:l(()=>[v("div",A,[t(M,{icon:o.success?"success":"error",title:o.title,"sub-title":o.subTitle},{extra:l(()=>[t(f,{type:"primary",onClick:e[5]||(e[5]=n=>i.value=!1)},{default:l(()=>e[10]||(e[10]=[y("确定")])),_:1,__:[10]})]),_:1},8,["icon","title","sub-title"])])]),_:1},8,["modelValue"])])}}},E=D(G,[["__scopeId","data-v-af3ffe40"]]);export{E as default};
