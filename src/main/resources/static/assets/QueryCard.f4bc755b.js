import{_ as M,h as Q,r as p,a as l,j as q,o as f,c as F,b as t,w as e,k as w,l as D,e as u,n as K,d as x,i as r,t as o,q as j,v as z,E as R,s as L,x as T}from"./index.beb69eb0.js";import{a as U}from"./axios.3a665b0f.js";const Y={class:"query-card"},J={class:"balance"},O={__name:"QueryCard",setup(P){const c=Q({studentId:""}),I=p(!1),$=p(!1),n=p(null),m=p([]),v=p(!1),k=async()=>{if(!c.studentId){R.warning("请输入学生ID");return}try{I.value=!0,v.value=!1;const d=await U.get(`http://127.0.0.1:8080/api/v1/cards/student/${c.studentId}`);n.value=d.data,m.value=d.data.transactions||[]}catch(d){n.value=null,m.value=[],v.value=!0,R.error(d.message||"查询失败")}finally{I.value=!1}},V=()=>{c.studentId="",n.value=null,m.value=[],v.value=!1},C=d=>{if(!d)return"";const a=new Date(d),S=a.getFullYear(),y=String(a.getMonth()+1).padStart(2,"0"),g=String(a.getDate()).padStart(2,"0"),h=String(a.getHours()).padStart(2,"0"),E=String(a.getMinutes()).padStart(2,"0"),_=String(a.getSeconds()).padStart(2,"0");return`${S}-${y}-${g} ${h}:${E}:${_}`};return(d,a)=>{const S=l("el-input"),y=l("el-form-item"),g=l("el-icon"),h=l("el-button"),E=l("el-form"),_=l("el-card"),i=l("el-descriptions-item"),A=l("el-descriptions"),b=l("el-table-column"),H=l("el-tag"),N=l("el-table"),B=l("el-empty"),G=q("loading");return f(),F("div",Y,[t(_,{class:"search-container"},{header:e(()=>a[1]||(a[1]=[u("div",{class:"card-header"},[u("h3",null,"校园卡信息查询")],-1)])),default:e(()=>[t(E,{inline:!0,model:c,class:"search-form"},{default:e(()=>[t(y,{label:"学生ID"},{default:e(()=>[t(S,{modelValue:c.studentId,"onUpdate:modelValue":a[0]||(a[0]=s=>c.studentId=s),placeholder:"请输入学生ID",clearable:"",onKeyup:K(k,["enter"])},null,8,["modelValue"])]),_:1}),t(y,null,{default:e(()=>[t(h,{type:"primary",onClick:k,loading:I.value},{default:e(()=>[t(g,null,{default:e(()=>[t(x(L))]),_:1}),a[2]||(a[2]=r("查询 "))]),_:1,__:[2]},8,["loading"]),t(h,{onClick:V},{default:e(()=>[t(g,null,{default:e(()=>[t(x(T))]),_:1}),a[3]||(a[3]=r("重置 "))]),_:1,__:[3]})]),_:1})]),_:1},8,["model"])]),_:1}),n.value?(f(),w(_,{key:0,class:"result-container"},{header:e(()=>a[4]||(a[4]=[u("div",{class:"card-header"},[u("h3",null,"查询结果")],-1)])),default:e(()=>[t(A,{column:2,border:""},{default:e(()=>[t(i,{label:"学生ID"},{default:e(()=>[r(o(n.value.studentId),1)]),_:1}),t(i,{label:"学生姓名"},{default:e(()=>[r(o(n.value.studentName),1)]),_:1}),t(i,{label:"当前余额"},{default:e(()=>[u("span",J,"¥ "+o(n.value.balance),1)]),_:1}),t(i,{label:"创建时间"},{default:e(()=>[r(o(C(n.value.createdAt)),1)]),_:1}),t(i,{label:"最后更新时间"},{default:e(()=>[r(o(C(n.value.updatedAt)),1)]),_:1}),t(i,{label:"卡片Id"},{default:e(()=>[r(o(n.value.id),1)]),_:1})]),_:1})]),_:1})):D("",!0),n.value?(f(),w(_,{key:1,class:"transactions-container"},{header:e(()=>a[5]||(a[5]=[u("div",{class:"card-header"},[u("h3",null,"最近交易记录")],-1)])),default:e(()=>[j((f(),w(N,{data:m.value,style:{width:"100%"}},{default:e(()=>[t(b,{prop:"time",label:"交易时间",width:"180"},{default:e(s=>[r(o(C(s.row.time)),1)]),_:1}),t(b,{prop:"type",label:"交易类型",width:"120"},{default:e(s=>[t(H,{type:s.row.type==="RECHARGE"?"success":"warning"},{default:e(()=>[r(o(s.row.type==="RECHARGE"?"充值":"消费"),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"amount",label:"交易金额",width:"120"},{default:e(s=>[u("span",{class:z(s.row.type==="RECHARGE"?"income":"expense")},o(s.row.type==="RECHARGE"?"+":"-")+" ¥"+o(s.row.amount),3)]),_:1}),t(b,{prop:"description",label:"交易描述"})]),_:1},8,["data"])),[[G,$.value]])]),_:1})):D("",!0),v.value?(f(),w(B,{key:2,description:"未找到相关校园卡信息"})):D("",!0)])}}},Z=M(O,[["__scopeId","data-v-f1fcfeca"]]);export{Z as default};
