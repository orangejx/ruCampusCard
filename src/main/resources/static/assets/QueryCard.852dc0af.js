import{_ as S,h as q,r as _,a as n,j as z,o as p,c as K,b as t,w as e,k as y,l as w,e as u,n as L,d as D,i as r,t as o,q as $,v as j,E as R,s as F,x as M}from"./index.7771fa4d.js";import{a as U}from"./axios.3a665b0f.js";const J={class:"query-card"},O={class:"balance"},P={__name:"QueryCard",setup(W){const c=q({studentId:""}),b=_(!1),V=_(!1),a=_(null),m=_([]),f=_(!1),C=async()=>{if(!c.studentId){R.warning("请输入学生ID");return}try{b.value=!0,f.value=!1;const d=await U.get(`/api/v1/cards/student/${c.studentId}`);a.value=d,m.value=d.transactions||[]}catch(d){a.value=null,m.value=[],f.value=!0,R.error(d.message||"查询失败")}finally{b.value=!1}},A=()=>{c.studentId="",a.value=null,m.value=[],f.value=!1},g=d=>d?new Date(d).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"";return(d,l)=>{const N=n("el-input"),I=n("el-form-item"),E=n("el-icon"),k=n("el-button"),T=n("el-form"),h=n("el-card"),i=n("el-descriptions-item"),x=n("el-tag"),B=n("el-descriptions"),v=n("el-table-column"),G=n("el-table"),H=n("el-empty"),Q=z("loading");return p(),K("div",J,[t(h,{class:"search-container"},{header:e(()=>l[1]||(l[1]=[u("div",{class:"card-header"},[u("h3",null,"校园卡信息查询")],-1)])),default:e(()=>[t(T,{inline:!0,model:c,class:"search-form"},{default:e(()=>[t(I,{label:"学生ID"},{default:e(()=>[t(N,{modelValue:c.studentId,"onUpdate:modelValue":l[0]||(l[0]=s=>c.studentId=s),placeholder:"请输入学生ID",clearable:"",onKeyup:L(C,["enter"])},null,8,["modelValue"])]),_:1}),t(I,null,{default:e(()=>[t(k,{type:"primary",onClick:C,loading:b.value},{default:e(()=>[t(E,null,{default:e(()=>[t(D(F))]),_:1}),l[2]||(l[2]=r("查询 "))]),_:1,__:[2]},8,["loading"]),t(k,{onClick:A},{default:e(()=>[t(E,null,{default:e(()=>[t(D(M))]),_:1}),l[3]||(l[3]=r("重置 "))]),_:1,__:[3]})]),_:1})]),_:1},8,["model"])]),_:1}),a.value?(p(),y(h,{key:0,class:"result-container"},{header:e(()=>l[4]||(l[4]=[u("div",{class:"card-header"},[u("h3",null,"查询结果")],-1)])),default:e(()=>[t(B,{column:2,border:""},{default:e(()=>[t(i,{label:"学生ID"},{default:e(()=>[r(o(a.value.studentId),1)]),_:1}),t(i,{label:"学生姓名"},{default:e(()=>[r(o(a.value.studentName),1)]),_:1}),t(i,{label:"当前余额"},{default:e(()=>[u("span",O,"¥ "+o(a.value.balance),1)]),_:1}),t(i,{label:"创建时间"},{default:e(()=>[r(o(g(a.value.createTime)),1)]),_:1}),t(i,{label:"最后更新时间"},{default:e(()=>[r(o(g(a.value.updateTime)),1)]),_:1}),t(i,{label:"卡片状态"},{default:e(()=>[t(x,{type:a.value.status==="ACTIVE"?"success":"danger"},{default:e(()=>[r(o(a.value.status==="ACTIVE"?"正常":"已注销"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})):w("",!0),a.value?(p(),y(h,{key:1,class:"transactions-container"},{header:e(()=>l[5]||(l[5]=[u("div",{class:"card-header"},[u("h3",null,"最近交易记录")],-1)])),default:e(()=>[$((p(),y(G,{data:m.value,style:{width:"100%"}},{default:e(()=>[t(v,{prop:"time",label:"交易时间",width:"180"},{default:e(s=>[r(o(g(s.row.time)),1)]),_:1}),t(v,{prop:"type",label:"交易类型",width:"120"},{default:e(s=>[t(x,{type:s.row.type==="RECHARGE"?"success":"warning"},{default:e(()=>[r(o(s.row.type==="RECHARGE"?"充值":"消费"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"amount",label:"交易金额",width:"120"},{default:e(s=>[u("span",{class:j(s.row.type==="RECHARGE"?"income":"expense")},o(s.row.type==="RECHARGE"?"+":"-")+" ¥"+o(s.row.amount),3)]),_:1}),t(v,{prop:"description",label:"交易描述"})]),_:1},8,["data"])),[[Q,V.value]])]),_:1})):w("",!0),f.value?(p(),y(H,{key:2,description:"未找到相关校园卡信息"})):w("",!0)])}}},Z=S(P,[["__scopeId","data-v-3a618bd1"]]);export{Z as default};
