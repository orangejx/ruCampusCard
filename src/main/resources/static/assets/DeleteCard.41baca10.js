import{_ as S,r as v,h as I,a as r,o as w,c as C,b as t,w as l,e as d,F as j,i as f,t as z,l as G,d as D,E as c,g as H,x as J}from"./index.46c576b9.js";import{a as T}from"./axios.3a665b0f.js";const K={class:"delete-card"},L={class:"warning-box"},O={class:"result-content"},P={__name:"DeleteCard",setup(Q){const p=v(null),b=v(!1),_=v(!1),a=v(null),u=I({success:!1,title:"",subTitle:""}),s=I({studentId:"",reason:"",confirmation:!1}),k=I({studentId:[{required:!0,message:"请输入学生ID",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],reason:[{required:!0,message:"请输入注销原因",trigger:"blur"},{min:5,max:200,message:"长度在 5 到 200 个字符",trigger:"blur"}],confirmation:[{validator:(n,e,m)=>{e?m():m(new Error("请确认注销操作"))},trigger:"change"}]}),E=async()=>{if(s.studentId)try{const n=await T.get(`http://127.0.0.1:8080/api/v1/cards/students/${s.studentId}`);a.value=n,n.status!=="ACTIVE"?c.warning("该校园卡已经被注销"):n.balance>0&&c.warning("该卡还有余额，建议先处理余额后再注销")}catch(n){a.value=null,c.error(n.message||"获取校园卡信息失败")}},$=async n=>{n&&await n.validate(async e=>{if(e){if(!a.value){c.warning("请先输入有效的学生ID");return}if(a.value.status!=="ACTIVE"){c.warning("该校园卡已经被注销");return}try{b.value=!0,await T.delete(`http://127.0.0.1:8080/api/v1/cards/student/${s.studentId}`),u.success=!0,u.title="注销成功",u.subTitle=`学生ID为 ${s.studentId} 的校园卡已成功注销`,_.value=!0}catch(m){u.success=!1,u.title="注销失败",u.subTitle=m.message||"注销过程中发生错误",_.value=!0}finally{b.value=!1}}})},x=n=>{n&&(n.resetFields(),a.value=null)},N=()=>{_.value=!1,u.success&&x(p.value)};return(n,e)=>{const m=r("el-alert"),g=r("el-input"),i=r("el-form-item"),U=r("el-tag"),A=r("el-checkbox"),y=r("el-icon"),V=r("el-button"),F=r("el-popconfirm"),B=r("el-form"),q=r("el-card"),R=r("el-result"),M=r("el-dialog");return w(),C("div",K,[t(q,{class:"card-container"},{header:l(()=>e[8]||(e[8]=[d("div",{class:"card-header"},[d("h3",null,"校园卡注销")],-1)])),default:l(()=>[d("div",L,[t(m,{title:"注意：校园卡注销后将无法恢复，请谨慎操作！",type:"warning",closable:!1,"show-icon":""},{default:l(()=>e[9]||(e[9]=[d("p",null,"注销前请确保：",-1),d("ol",null,[d("li",null,"已确认该卡片不再使用"),d("li",null,"已处理卡内剩余余额"),d("li",null,"已完成所有待处理的交易")],-1)])),_:1,__:[9]})]),t(B,{ref_key:"formRef",ref:p,model:s,rules:k,"label-width":"120px","label-position":"right","status-icon":""},{default:l(()=>[t(i,{label:"学生ID",prop:"studentId"},{default:l(()=>[t(g,{modelValue:s.studentId,"onUpdate:modelValue":e[0]||(e[0]=o=>s.studentId=o),placeholder:"请输入要注销的学生ID",clearable:"",onBlur:E},null,8,["modelValue"])]),_:1}),a.value?(w(),C(j,{key:0},[t(i,{label:"学生姓名"},{default:l(()=>[t(g,{modelValue:a.value.studentName,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.studentName=o),disabled:""},null,8,["modelValue"])]),_:1}),t(i,{label:"当前余额"},{default:l(()=>[t(g,{modelValue:a.value.balance,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.balance=o),disabled:""},{prepend:l(()=>e[10]||(e[10]=[f("¥")])),_:1},8,["modelValue"])]),_:1}),t(i,{label:"卡片状态"},{default:l(()=>[t(U,{type:a.value.status==="ACTIVE"?"success":"danger"},{default:l(()=>[f(z(a.value.status==="ACTIVE"?"正常":"已注销"),1)]),_:1},8,["type"])]),_:1})],64)):G("",!0),t(i,{label:"注销原因",prop:"reason"},{default:l(()=>[t(g,{modelValue:s.reason,"onUpdate:modelValue":e[3]||(e[3]=o=>s.reason=o),type:"textarea",rows:3,placeholder:"请输入注销原因"},null,8,["modelValue"])]),_:1}),t(i,{label:"确认注销",prop:"confirmation"},{default:l(()=>[t(A,{modelValue:s.confirmation,"onUpdate:modelValue":e[4]||(e[4]=o=>s.confirmation=o)},{default:l(()=>e[11]||(e[11]=[f(" 我已了解注销后果，确认要注销此校园卡 ")])),_:1,__:[11]},8,["modelValue"])]),_:1}),t(i,null,{default:l(()=>[t(F,{title:"确定要注销这张校园卡吗？","confirm-button-text":"确定注销","cancel-button-text":"再想想",onConfirm:e[5]||(e[5]=o=>$(p.value))},{reference:l(()=>[t(V,{type:"danger",disabled:!s.confirmation||!a.value||a.value.status!=="ACTIVE",loading:b.value},{default:l(()=>[t(y,null,{default:l(()=>[t(D(H))]),_:1}),e[12]||(e[12]=f("注销校园卡 "))]),_:1,__:[12]},8,["disabled","loading"])]),_:1}),t(V,{onClick:e[6]||(e[6]=o=>x(p.value))},{default:l(()=>[t(y,null,{default:l(()=>[t(D(J))]),_:1}),e[13]||(e[13]=f("重置 "))]),_:1,__:[13]})]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(M,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=o=>_.value=o),title:"注销结果",width:"30%",center:""},{default:l(()=>[d("div",O,[t(R,{icon:u.success?"success":"error",title:u.title,"sub-title":u.subTitle},{extra:l(()=>[t(V,{type:"primary",onClick:N},{default:l(()=>e[14]||(e[14]=[f("确定")])),_:1,__:[14]})]),_:1},8,["icon","title","sub-title"])])]),_:1},8,["modelValue"])])}}},Y=S(P,[["__scopeId","data-v-e8db9763"]]);export{Y as default};
