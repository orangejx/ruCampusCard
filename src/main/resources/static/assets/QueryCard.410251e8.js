import{_ as M,h as Q,r as v,a as s,j as T,o as y,c as q,b as t,w as e,k as I,l as D,e as u,n as F,d as V,i as d,t as r,q as K,v as j,E as C,s as z,x as L}from"./index.5bfda754.js";import{a as U}from"./axios.3a665b0f.js";const Y={class:"query-card"},J={class:"balance"},O={__name:"QueryCard",setup(P){const c=Q({studentId:""}),E=v(!1),$=v(!1),l=v(null),i=v([]),_=v(!1),k=async()=>{var p,a;if(!c.studentId){C.warning("请输入学生ID");return}try{E.value=!0,_.value=!1;const n=await U.get(`/api/v1/cards/student/${c.studentId}`);n.data.code===200?n.data.data?(l.value=n.data.data,i.value=n.data.data.transactions||[]):(l.value=null,i.value=[],_.value=!0,C.warning("未找到相关校园卡信息")):(l.value=null,i.value=[],_.value=!0,C.error(n.data.msg||"查询失败"))}catch(n){l.value=null,i.value=[],_.value=!0,C.error(((a=(p=n.response)==null?void 0:p.data)==null?void 0:a.msg)||n.message||"查询失败")}finally{E.value=!1}},A=()=>{c.studentId="",l.value=null,i.value=[],_.value=!1},x=p=>{if(!p)return"";const a=new Date(p),n=a.getFullYear(),g=String(a.getMonth()+1).padStart(2,"0"),b=String(a.getDate()).padStart(2,"0"),h=String(a.getHours()).padStart(2,"0"),S=String(a.getMinutes()).padStart(2,"0"),f=String(a.getSeconds()).padStart(2,"0");return`${n}-${g}-${b} ${h}:${S}:${f}`};return(p,a)=>{const n=s("el-input"),g=s("el-form-item"),b=s("el-icon"),h=s("el-button"),S=s("el-form"),f=s("el-card"),m=s("el-descriptions-item"),R=s("el-tag"),H=s("el-descriptions"),w=s("el-table-column"),N=s("el-table"),B=s("el-empty"),G=T("loading");return y(),q("div",Y,[t(f,{class:"search-container"},{header:e(()=>a[1]||(a[1]=[u("div",{class:"card-header"},[u("h3",null,"校园卡信息查询")],-1)])),default:e(()=>[t(S,{inline:!0,model:c,class:"search-form"},{default:e(()=>[t(g,{label:"学生ID"},{default:e(()=>[t(n,{modelValue:c.studentId,"onUpdate:modelValue":a[0]||(a[0]=o=>c.studentId=o),placeholder:"请输入学生ID",clearable:"",onKeyup:F(k,["enter"])},null,8,["modelValue"])]),_:1}),t(g,null,{default:e(()=>[t(h,{type:"primary",onClick:k,loading:E.value},{default:e(()=>[t(b,null,{default:e(()=>[t(V(z))]),_:1}),a[2]||(a[2]=d("查询 "))]),_:1,__:[2]},8,["loading"]),t(h,{onClick:A},{default:e(()=>[t(b,null,{default:e(()=>[t(V(L))]),_:1}),a[3]||(a[3]=d("重置 "))]),_:1,__:[3]})]),_:1})]),_:1},8,["model"])]),_:1}),l.value?(y(),I(f,{key:0,class:"result-container"},{header:e(()=>a[4]||(a[4]=[u("div",{class:"card-header"},[u("h3",null,"查询结果")],-1)])),default:e(()=>[t(H,{column:2,border:""},{default:e(()=>[t(m,{label:"学生ID"},{default:e(()=>[d(r(l.value.studentId),1)]),_:1}),t(m,{label:"学生姓名"},{default:e(()=>[d(r(l.value.studentName),1)]),_:1}),t(m,{label:"当前余额"},{default:e(()=>[u("span",J,"¥ "+r(l.value.balance),1)]),_:1}),t(m,{label:"最后使用时间"},{default:e(()=>[d(r(x(l.value.updatedAt)),1)]),_:1}),t(m,{label:"卡片Id"},{default:e(()=>[d(r(l.value.id),1)]),_:1}),t(m,{label:"卡片状态"},{default:e(()=>[t(R,{type:l.value.status==="ACTIVE"?"success":"danger"},{default:e(()=>[d(r(l.value.status==="ACTIVE"?"正常":"已注销"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})):D("",!0),l.value?(y(),I(f,{key:1,class:"transactions-container"},{header:e(()=>a[5]||(a[5]=[u("div",{class:"card-header"},[u("h3",null,"最近交易记录")],-1)])),default:e(()=>[K((y(),I(N,{data:i.value,style:{width:"100%"}},{default:e(()=>[t(w,{prop:"time",label:"交易时间",width:"180"},{default:e(o=>[d(r(x(o.row.time)),1)]),_:1}),t(w,{prop:"type",label:"交易类型",width:"120"},{default:e(o=>[t(R,{type:o.row.type==="RECHARGE"?"success":"warning"},{default:e(()=>[d(r(o.row.type==="RECHARGE"?"充值":"消费"),1)]),_:2},1032,["type"])]),_:1}),t(w,{prop:"amount",label:"交易金额",width:"120"},{default:e(o=>[u("span",{class:j(o.row.type==="RECHARGE"?"income":"expense")},r(o.row.type==="RECHARGE"?"+":"-")+" ¥"+r(o.row.amount),3)]),_:1}),t(w,{prop:"description",label:"交易描述"})]),_:1},8,["data"])),[[G,$.value]])]),_:1})):D("",!0),_.value?(y(),I(B,{key:2,description:"未找到相关校园卡信息"})):D("",!0)])}}},Z=M(O,[["__scopeId","data-v-545350c7"]]);export{Z as default};
