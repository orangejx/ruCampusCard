import{_ as T,h as q,r as _,a as l,j as z,o as p,c as K,b as t,w as e,k as y,l as w,e as u,n as L,d as x,i as r,t as s,q as $,v as j,E as D,s as F,x as M}from"./index.46c576b9.js";import{a as U}from"./axios.3a665b0f.js";const J={class:"query-card"},O={class:"balance"},P={__name:"QueryCard",setup(W){const c=q({studentId:""}),b=_(!1),R=_(!1),n=_(null),m=_([]),f=_(!1),C=async()=>{if(!c.studentId){D.warning("请输入学生ID");return}try{b.value=!0,f.value=!1;const d=await U.get(`http://127.0.0.1:8080/api/v1/cards/student/${c.studentId}`);n.value=d,m.value=d.transactions||[]}catch(d){n.value=null,m.value=[],f.value=!0,D.error(d.message||"查询失败")}finally{b.value=!1}},V=()=>{c.studentId="",n.value=null,m.value=[],f.value=!1},h=d=>d?new Date(d).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"";return(d,a)=>{const N=l("el-input"),I=l("el-form-item"),E=l("el-icon"),k=l("el-button"),A=l("el-form"),g=l("el-card"),i=l("el-descriptions-item"),B=l("el-descriptions"),v=l("el-table-column"),G=l("el-tag"),H=l("el-table"),Q=l("el-empty"),S=z("loading");return p(),K("div",J,[t(g,{class:"search-container"},{header:e(()=>a[1]||(a[1]=[u("div",{class:"card-header"},[u("h3",null,"校园卡信息查询")],-1)])),default:e(()=>[t(A,{inline:!0,model:c,class:"search-form"},{default:e(()=>[t(I,{label:"学生ID"},{default:e(()=>[t(N,{modelValue:c.studentId,"onUpdate:modelValue":a[0]||(a[0]=o=>c.studentId=o),placeholder:"请输入学生ID",clearable:"",onKeyup:L(C,["enter"])},null,8,["modelValue"])]),_:1}),t(I,null,{default:e(()=>[t(k,{type:"primary",onClick:C,loading:b.value},{default:e(()=>[t(E,null,{default:e(()=>[t(x(F))]),_:1}),a[2]||(a[2]=r("查询 "))]),_:1,__:[2]},8,["loading"]),t(k,{onClick:V},{default:e(()=>[t(E,null,{default:e(()=>[t(x(M))]),_:1}),a[3]||(a[3]=r("重置 "))]),_:1,__:[3]})]),_:1})]),_:1},8,["model"])]),_:1}),n.value?(p(),y(g,{key:0,class:"result-container"},{header:e(()=>a[4]||(a[4]=[u("div",{class:"card-header"},[u("h3",null,"查询结果")],-1)])),default:e(()=>[t(B,{column:2,border:""},{default:e(()=>[t(i,{label:"学生ID"},{default:e(()=>[r(s(n.value.studentId),1)]),_:1}),t(i,{label:"学生姓名"},{default:e(()=>[r(s(n.value.studentName),1)]),_:1}),t(i,{label:"当前余额"},{default:e(()=>[u("span",O,"¥ "+s(n.value.balance),1)]),_:1}),t(i,{label:"创建时间"},{default:e(()=>[r(s(h(n.value.createTime)),1)]),_:1}),t(i,{label:"最后更新时间"},{default:e(()=>[r(s(h(n.value.updateTime)),1)]),_:1}),t(i,{label:"卡片Id"},{default:e(()=>[r(s(n.value.id),1)]),_:1})]),_:1})]),_:1})):w("",!0),n.value?(p(),y(g,{key:1,class:"transactions-container"},{header:e(()=>a[5]||(a[5]=[u("div",{class:"card-header"},[u("h3",null,"最近交易记录")],-1)])),default:e(()=>[$((p(),y(H,{data:m.value,style:{width:"100%"}},{default:e(()=>[t(v,{prop:"time",label:"交易时间",width:"180"},{default:e(o=>[r(s(h(o.row.time)),1)]),_:1}),t(v,{prop:"type",label:"交易类型",width:"120"},{default:e(o=>[t(G,{type:o.row.type==="RECHARGE"?"success":"warning"},{default:e(()=>[r(s(o.row.type==="RECHARGE"?"充值":"消费"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"amount",label:"交易金额",width:"120"},{default:e(o=>[u("span",{class:j(o.row.type==="RECHARGE"?"income":"expense")},s(o.row.type==="RECHARGE"?"+":"-")+" ¥"+s(o.row.amount),3)]),_:1}),t(v,{prop:"description",label:"交易描述"})]),_:1},8,["data"])),[[S,R.value]])]),_:1})):w("",!0),f.value?(p(),y(Q,{key:2,description:"未找到相关校园卡信息"})):w("",!0)])}}},Z=T(P,[["__scopeId","data-v-f403fbfc"]]);export{Z as default};
