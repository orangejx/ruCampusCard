import{_ as M,h as Q,r as p,a as n,j as T,o as m,c as q,b as t,w as e,k as w,l as S,e as u,n as F,d as R,i as r,t as o,q as K,v as j,E as V,s as z,x as L}from"./index.05ff2716.js";import{a as U}from"./axios.3a665b0f.js";const Y={class:"query-card"},J={class:"balance"},O={__name:"QueryCard",setup(P){const c=Q({studentId:""}),I=p(!1),$=p(!1),l=p(null),f=p([]),v=p(!1),D=async()=>{if(!c.studentId){V.warning("请输入学生ID");return}try{I.value=!0,v.value=!1;const d=await U.get(`/api/v1/cards/student/${c.studentId}`);l.value=d.data,f.value=d.data.transactions||[]}catch(d){l.value=null,f.value=[],v.value=!0,V.error(d.message||"查询失败")}finally{I.value=!1}},A=()=>{c.studentId="",l.value=null,f.value=[],v.value=!1},k=d=>{if(!d)return"";const a=new Date(d),C=a.getFullYear(),y=String(a.getMonth()+1).padStart(2,"0"),g=String(a.getDate()).padStart(2,"0"),b=String(a.getHours()).padStart(2,"0"),E=String(a.getMinutes()).padStart(2,"0"),_=String(a.getSeconds()).padStart(2,"0");return`${C}-${y}-${g} ${b}:${E}:${_}`};return(d,a)=>{const C=n("el-input"),y=n("el-form-item"),g=n("el-icon"),b=n("el-button"),E=n("el-form"),_=n("el-card"),i=n("el-descriptions-item"),x=n("el-tag"),H=n("el-descriptions"),h=n("el-table-column"),N=n("el-table"),B=n("el-empty"),G=T("loading");return m(),q("div",Y,[t(_,{class:"search-container"},{header:e(()=>a[1]||(a[1]=[u("div",{class:"card-header"},[u("h3",null,"校园卡信息查询")],-1)])),default:e(()=>[t(E,{inline:!0,model:c,class:"search-form"},{default:e(()=>[t(y,{label:"学生ID"},{default:e(()=>[t(C,{modelValue:c.studentId,"onUpdate:modelValue":a[0]||(a[0]=s=>c.studentId=s),placeholder:"请输入学生ID",clearable:"",onKeyup:F(D,["enter"])},null,8,["modelValue"])]),_:1}),t(y,null,{default:e(()=>[t(b,{type:"primary",onClick:D,loading:I.value},{default:e(()=>[t(g,null,{default:e(()=>[t(R(z))]),_:1}),a[2]||(a[2]=r("查询 "))]),_:1,__:[2]},8,["loading"]),t(b,{onClick:A},{default:e(()=>[t(g,null,{default:e(()=>[t(R(L))]),_:1}),a[3]||(a[3]=r("重置 "))]),_:1,__:[3]})]),_:1})]),_:1},8,["model"])]),_:1}),l.value?(m(),w(_,{key:0,class:"result-container"},{header:e(()=>a[4]||(a[4]=[u("div",{class:"card-header"},[u("h3",null,"查询结果")],-1)])),default:e(()=>[t(H,{column:2,border:""},{default:e(()=>[t(i,{label:"学生ID"},{default:e(()=>[r(o(l.value.studentId),1)]),_:1}),t(i,{label:"学生姓名"},{default:e(()=>[r(o(l.value.studentName),1)]),_:1}),t(i,{label:"当前余额"},{default:e(()=>[u("span",J,"¥ "+o(l.value.balance),1)]),_:1}),t(i,{label:"最后使用时间"},{default:e(()=>[r(o(k(l.value.updatedAt)),1)]),_:1}),t(i,{label:"卡片Id"},{default:e(()=>[r(o(l.value.id),1)]),_:1}),t(i,{label:"卡片状态"},{default:e(()=>[t(x,{type:l.value.status==="ACTIVE"?"success":"danger"},{default:e(()=>[r(o(l.value.status==="ACTIVE"?"正常":"已注销"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})):S("",!0),l.value?(m(),w(_,{key:1,class:"transactions-container"},{header:e(()=>a[5]||(a[5]=[u("div",{class:"card-header"},[u("h3",null,"最近交易记录")],-1)])),default:e(()=>[K((m(),w(N,{data:f.value,style:{width:"100%"}},{default:e(()=>[t(h,{prop:"time",label:"交易时间",width:"180"},{default:e(s=>[r(o(k(s.row.time)),1)]),_:1}),t(h,{prop:"type",label:"交易类型",width:"120"},{default:e(s=>[t(x,{type:s.row.type==="RECHARGE"?"success":"warning"},{default:e(()=>[r(o(s.row.type==="RECHARGE"?"充值":"消费"),1)]),_:2},1032,["type"])]),_:1}),t(h,{prop:"amount",label:"交易金额",width:"120"},{default:e(s=>[u("span",{class:j(s.row.type==="RECHARGE"?"income":"expense")},o(s.row.type==="RECHARGE"?"+":"-")+" ¥"+o(s.row.amount),3)]),_:1}),t(h,{prop:"description",label:"交易描述"})]),_:1},8,["data"])),[[G,$.value]])]),_:1})):S("",!0),v.value?(m(),w(B,{key:2,description:"未找到相关校园卡信息"})):S("",!0)])}}},Z=M(O,[["__scopeId","data-v-2689c531"]]);export{Z as default};
